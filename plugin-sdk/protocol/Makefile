# Plugin SDK - Protocol Makefile
# ç”¨äºç”ŸæˆgRPCä»£ç 

.PHONY: all generate clean install-tools

all: generate

# ç”ŸæˆgRPCä»£ç 
generate:
	@echo "ğŸ”§ Generating gRPC code from provider.proto..."
	set PATH="$$PATH:$$HOME/go/bin" && \
	protoc --go_out=. --go_opt=paths=source_relative \
	       --go-grpc_out=. --go-grpc_opt=paths=source_relative \
	       provider.proto
	@echo "âœ… gRPC code generated successfully!"

# å®‰è£…å¿…è¦çš„å·¥å…·
install-tools:
	@echo "ğŸ“¦ Installing protoc plugins..."
	go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
	go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
	@echo "âœ… Tools installed!"

# æ¸…ç†ç”Ÿæˆçš„æ–‡ä»¶
clean:
	@echo "ğŸ§¹ Cleaning generated files..."
	rm -f provider.pb.go provider_grpc.pb.go
	@echo "âœ… Clean complete!"

# æ£€æŸ¥protocæ˜¯å¦å®‰è£…
check:
	@echo "ğŸ” Checking protoc installation..."
	@which protoc > /dev/null || (echo "âŒ protoc not found! Please install Protocol Buffers compiler." && exit 1)
	@which protoc-gen-go > /dev/null || (echo "âŒ protoc-gen-go not found! Run 'make install-tools'" && exit 1)
	@which protoc-gen-go-grpc > /dev/null || (echo "âŒ protoc-gen-go-grpc not found! Run 'make install-tools'" && exit 1)
	@echo "âœ… All required tools are installed!"

